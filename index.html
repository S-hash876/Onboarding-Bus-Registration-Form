<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Owner Registration Form</title>
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.3.4/dist/css/tabulator.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .hidden {
            display: none;
        }
        .form-section {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select, button {
            padding: 8px;
            margin-bottom: 10px;
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

<h1>Bus Owner Registration Form</h1>

<form id="busOwnerForm">
    <div class="form-section">
        <h2>Owner Details</h2>
        <label for="ownerName">Name<span>*</span></label>
        <input type="text" id="ownerName" name="ownerName" required aria-label="Owner's Name">

        <label for="primaryPhone">Primary Phone<span>*</span></label>
        <input type="tel" id="primaryPhone" name="primaryPhone" pattern="[0-9]{10}" required aria-label="Primary Phone Number">

        <label for="secondaryPhone">Secondary Phone</label>
        <input type="tel" id="secondaryPhone" name="secondaryPhone" pattern="[0-9]{10}" aria-label="Secondary Phone Number">
    </div>

    <div class="form-section">
        <h2>Bus Details</h2>
        <label for="numberOfBuses">Number of Buses<span>*</span></label>
        <input type="number" id="numberOfBuses" name="numberOfBuses" min="1" max="50" required>

        <button type="button" onclick="generateBusDetails()">Generate Bus Details</button>
    </div>

    <div id="busDetailsContainer"></div>

    <button type="submit" id="submitBtn" class="hidden">Submit Registration</button>
</form>

<h2>Existing Data</h2>
<div id="dataTable"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://unpkg.com/tabulator-tables@5.3.4/dist/js/tabulator.min.js"></script>
<script>
const SHEET_URL = "YOUR_GOOGLE_SHEET_URL";

function generateBusDetails() {
    const numberOfBuses = parseInt(document.getElementById('numberOfBuses').value);
    const busDetailsContainer = document.getElementById('busDetailsContainer');
    busDetailsContainer.innerHTML = '';

    if (numberOfBuses > 0) {
        for (let i = 1; i <= numberOfBuses; i++) {
            const busDiv = document.createElement('div');
            busDiv.classList.add('form-section');
            busDiv.innerHTML = `
                <h3>Bus ${i}</h3>
                <label for="fare${i}">Fare<span>*</span></label>
                <input type="number" id="fare${i}" name="fare${i}" min="0" required>

                <label for="numberOfStops${i}">Number of Stops<span>*</span></label>
                <select id="numberOfStops${i}" name="numberOfStops${i}" required onchange="generateStopDetails(${i})">
                    <option value="" disabled selected>Select</option>
                    ${Array.from({ length: 10 }, (_, idx) => `<option value="${idx + 1}">${idx + 1}</option>`).join('')}
                </select>

                <div id="stopDetailsContainer${i}"></div>
            `;
            busDetailsContainer.appendChild(busDiv);
        }
        document.getElementById('submitBtn').classList.remove('hidden');
    } else {
        document.getElementById('submitBtn').classList.add('hidden');
    }
}

function generateStopDetails(busIndex) {
    const numberOfStops = parseInt(document.getElementById(`numberOfStops${busIndex}`).value);
    const stopDetailsContainer = document.getElementById(`stopDetailsContainer${busIndex}`);
    stopDetailsContainer.innerHTML = '';

    for (let i = 1; i <= numberOfStops; i++) {
        const stopDiv = document.createElement('div');
        stopDiv.innerHTML = `
            <label for="stopName${busIndex}_${i}">Stop ${i} Name<span>*</span></label>
            <input type="text" id="stopName${busIndex}_${i}" name="stopName${busIndex}_${i}" required>

            <label for="stopAddress${busIndex}_${i}">Stop ${i} Address<span>*</span></label>
            <input type="text" id="stopAddress${busIndex}_${i}" name="stopAddress${busIndex}_${i}" required>
        `;
        stopDetailsContainer.appendChild(stopDiv);
    }
}

document.getElementById('busOwnerForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const formObject = Object.fromEntries(formData.entries());

    // Validate form data
    if (!formObject.ownerName || !formObject.primaryPhone) {
        alert('Please fill out all required fields.');
        return;
    }

    console.log('Form submitted:', formObject);
    alert('Form submitted successfully!');
});

function loadSheetData() {
    Papa.parse(SHEET_URL, {
        download: true,
        header: true,
        complete: function(results) {
            if (results.errors.length > 0) {
                console.error('Error loading sheet:', results.errors);
                alert('Failed to load data from the sheet.');
            } else {
                new Tabulator("#dataTable", {
                    data: results.data,
                    layout: "fitColumns",
                    columns: [
                        { title: "Owner Name", field: "ownerName" },
                        { title: "Primary Phone", field: "primaryPhone" },
                        { title: "Bus Details", field: "busDetails" }
                    ]
                });
            }
        }
    });
}

loadSheetData();
</script>

</body>
</html>


