<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Owner Registration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .form-section {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, textarea, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .error {
            color: red;
            font-size: 0.9em;
            margin-top: -10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Bus Owner Registration Form</h1>

    <div id="ownerSection" class="form-section">
        <label for="ownerName">Owner Name*</label>
        <input type="text" id="ownerName" placeholder="Enter owner name">
        <div class="error" id="ownerNameError"></div>

        <label for="primaryPhone">Primary Phone Number*</label>
        <input type="text" id="primaryPhone" placeholder="Enter primary phone number">
        <div class="error" id="primaryPhoneError"></div>

        <label for="additionalPhone">Additional Phone Number</label>
        <input type="text" id="additionalPhone" placeholder="Enter additional phone number (optional)">

        <label for="address">Address*</label>
        <textarea id="address" placeholder="Enter address"></textarea>
        <div class="error" id="addressError"></div>

        <label for="numberOfBuses">Number of Buses*</label>
        <input type="number" id="numberOfBuses" placeholder="Enter number of buses" min="1">
        <div class="error" id="numberOfBusesError"></div>

        <button onclick="addBusDetails()">Add Bus Details</button>
    </div>

    <div id="busDetailsContainer" class="form-section"></div>

    <button id="submitBtn" onclick="submitForm()" style="display:none;">Submit Registration</button>

    <script>
        function validateField(id, errorId, message) {
            const field = document.getElementById(id);
            const errorField = document.getElementById(errorId);
            if (!field.value.trim()) {
                errorField.textContent = message;
                return false;
            } else {
                errorField.textContent = '';
                return true;
            }
        }

        function validateForm() {
            const isOwnerNameValid = validateField('ownerName', 'ownerNameError', 'Owner name is required.');
            const isPrimaryPhoneValid = validateField('primaryPhone', 'primaryPhoneError', 'Primary phone number is required.');
            const isAddressValid = validateField('address', 'addressError', 'Address is required.');
            const isNumberOfBusesValid = validateField('numberOfBuses', 'numberOfBusesError', 'Number of buses is required.');

            return isOwnerNameValid && isPrimaryPhoneValid && isAddressValid && isNumberOfBusesValid;
        }

        function addBusDetails() {
            const numberOfBuses = document.getElementById('numberOfBuses').value;

            if (!validateField('numberOfBuses', 'numberOfBusesError', 'Please enter a valid number of buses.')) {
                return;
            }

            const container = document.getElementById('busDetailsContainer');
            container.innerHTML = '';

            for (let i = 1; i <= numberOfBuses; i++) {
                container.innerHTML += `
                    <div class="form-section">
                        <h3>Bus ${i}</h3>
                        <label for="busName${i}">Bus Name*</label>
                        <input type="text" id="busName${i}" placeholder="Enter bus name">

                        <label for="busNumber${i}">Bus Number*</label>
                        <input type="text" id="busNumber${i}" placeholder="Enter bus number">

                        <label for="numberOfSeats${i}">Number of Seats*</label>
                        <input type="number" id="numberOfSeats${i}" placeholder="Enter number of seats" min="1">
                    </div>
                `;
            }

            document.getElementById('submitBtn').style.display = 'block';
        }

        function resetForm() {
            document.getElementById('ownerName').value = '';
            document.getElementById('primaryPhone').value = '';
            document.getElementById('additionalPhone').value = '';
            document.getElementById('address').value = '';
            document.getElementById('numberOfBuses').value = '';
            document.getElementById('busDetailsContainer').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'none';
            const errorFields = document.querySelectorAll('.error');
            errorFields.forEach(field => field.textContent = '');
        }

        function submitForm() {
            if (!validateForm()) {
                alert('Please fill in all required fields.');
                return;
            }

            const formData = {
                ownerName: document.getElementById('ownerName').value,
                primaryPhone: document.getElementById('primaryPhone').value,
                additionalPhone: document.getElementById('additionalPhone').value,
                address: document.getElementById('address').value,
                buses: []
            };

            const numberOfBuses = document.getElementById('numberOfBuses').value;
            for (let i = 1; i <= numberOfBuses; i++) {
                const bus = {
                    busName: document.getElementById(`busName${i}`).value,
                    busNumber: document.getElementById(`busNumber${i}`).value,
                    numberOfSeats: document.getElementById(`numberOfSeats${i}`).value
                };
                formData.buses.push(bus);
            }

            fetch('https://script.google.com/macros/s/AKfycbyUm8xBB9EHIx_XjLs0o54_HtJtSfmk_OPqz0lzZHJ-JIkYeRQcDwnEUQ4cEatDrrwjTA/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    alert('Registration Submitted Successfully!');
                    resetForm();
                } else {
                    alert('Error submitting form. Details: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(err => {
                alert('Error submitting form. Please try again. Details: ' + err.message);
            });
        }
    </script>
</body>
</html>
